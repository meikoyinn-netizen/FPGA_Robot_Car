# =============================================================================
# MicroPhase A7-Lite 约束文件 (针对 RISC-V 小车项目)
# =============================================================================

# -----------------------------------------------------------------------------
# 1. 时钟 (System Clock) - 50MHz
# -----------------------------------------------------------------------------
# 板载 50MHz 晶振连接在 Y18 管脚
set_property -dict { PACKAGE_PIN Y18  IOSTANDARD LVCMOS33 } [get_ports { clk }]
create_clock -add -name sys_clk_pin -period 20.00 -waveform {0 10} [get_ports { clk }]

# -----------------------------------------------------------------------------
# 2. 复位 (System Reset)
# -----------------------------------------------------------------------------
# 使用板载按键 KEY1 (M19) 作为复位，按下为低电平 (Active Low)，适配 rst_n
set_property -dict { PACKAGE_PIN M19  IOSTANDARD LVCMOS33 } [get_ports { rst_n }]

# -----------------------------------------------------------------------------
# 3. 调试 LED (Debug LEDs)
# -----------------------------------------------------------------------------
# 映射 dmem_wdata_debug 的低 2 位到板载 LED，用于点灯测试
# LED1 (J19)
set_property -dict { PACKAGE_PIN J19  IOSTANDARD LVCMOS33 } [get_ports { dmem_wdata_debug[0] }]
# LED2 (K19)
set_property -dict { PACKAGE_PIN K19  IOSTANDARD LVCMOS33 } [get_ports { dmem_wdata_debug[1] }]

# -----------------------------------------------------------------------------
# 4. UART 串口 (预留，后期调试用)
# -----------------------------------------------------------------------------
# 官方定义：FPGA_RX = M17, FPGA_TX = L17 (连接板载 CH340)
# 注意：代码中如果没有定义 uart 端口，这两行会报错，暂时注释掉或确保 riscv_top 有这两个端口
# set_property -dict { PACKAGE_PIN L17  IOSTANDARD LVCMOS33 } [get_ports { uart_tx }]
# set_property -dict { PACKAGE_PIN M17  IOSTANDARD LVCMOS33 } [get_ports { uart_rx }]

# -----------------------------------------------------------------------------
# 5. 配置选项 (防止报错)
# -----------------------------------------------------------------------------
set_property CFGBVS VCCO [current_design]
set_property CONFIG_VOLTAGE 3.3 [current_design]
# 压缩 Bitstream 大小，烧录更快
set_property BITSTREAM.GENERAL.COMPRESS TRUE [current_design] 
# 忽略未使用的引脚 (防止 dmem_wdata_debug[31:2] 没接引脚报错)
set_property BITSTREAM.CONFIG.UNUSEDPIN Pullnone [current_design]